# L1J-Rust

Lineage 1（3.80c 台湾版）游戏服务器，使用 **Rust** 编写。

本项目是 **L1J-TW Java 服务器的完整重写版本**，以极致性能为目标 —— 可在同屏处理 **10,000+ NPC** 而无卡顿。

---

## 功能特性

### 网络（Networking）
- Tokio 异步 TCP 监听（非阻塞 I/O）
- XOR Cipher 加密（1:1 移植自 Java `Cipher.java`）
- 封包帧（2-byte Little Endian 长度头）
- 完整支持 3.80c 台湾版协议（250+ Opcode）
- Big5 / MS950 中文编码显示

### 登录系统（Login System）
- 账号验证（SHA-1 + Base64，与 Java 完全一致）
- 首次登录自动创建账号
- 在线 / 离线状态追踪
- 断线自动清理（自动下线）

### 角色系统（Character System）
- 角色创建（7 职业：王族、骑士、妖精、法师、黑暗妖精、龙骑士、幻术师）
- 官方基础属性与 HP / MP 成长
- 角色列表显示
- 角色选择与进入游戏（17+ 初始化封包）
- 坐标追踪与断线保存

### 多人系统（Multiplayer）
- 共享世界状态
- 实时移动广播
- 附近聊天系统
- 玩家外观同步
- 玩家下线即时移除

### 世界系统（World System）
- 32x32 网格化空间分区
- O(k) 可视范围查询（替代 O(n)）
- 支持 V1 / V2 地图格式
- 通行、安全区 / 战斗区判定

### 游戏引擎（Game Engine）
- Tick 驱动 AI 引擎
- NPC 休眠优化
- 战斗计算系统
- NPC 生成管理

### 攻城系统（官方数据）
- 8 座城堡
- 战争状态机
- 城门与守护塔系统
- 王冠生成机制
- 投石机系统（仅伤害玩家）
- 城堡守卫（官方 HP）
- 攻城 Buff：王族守护（攻击力 +30）
- 黑骑士 NPC

### 技能系统（Skill System）
- 7 职业完整技能树
- 技能执行引擎
- Buff / Debuff 管理
- 冷却时间追踪
- 魔法抗性计算
- Buff 伤害整合

### 道具系统（Item System）
- 道具模板（Etc / 武器 / 防具）
- 背包与装备管理
- 道具封包支持

### 火神锻造系统（Vulcan Forge）
- 装备熔炼
- 火神结晶与契约
- 成功率加成
- 官方配方数据

### 传送系统（Teleport）
- 地下城入口
- 记忆坐标管理
- 地图切换与动画

### 血盟系统（Clan）
- 血盟管理
- 阶级制度
- 宣战系统
- 城主王冠显示
- 徽章支持

---

## 性能表现（Release）

| 项目 | 结果 |
|----|----|
| 生成 10,000 NPC | 4.49 ms |
| Tick 10,000 NPC | 平均 0.478 ms |
| Tick 预算占用 | 0.37% |
| 理论 NPC 上限 | 约 270,000 |

---

## 测试结果
- 102 个单元测试
- 2 个压力测试
- 全部通过

---

## 环境要求
- Rust 1.70+（测试于 1.93.0）
- MySQL 8.0+
- Lineage 1 客户端（3.80c 台湾版）

---

## 许可证
本项目仅用于教育与研究用途。
